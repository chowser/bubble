<!doctype html>
<html lang="en">
<head>
   <!-- Required meta tags -->
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

   <!-- Bootstrap CSS -->
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

   <title>Hello, world!</title>

</head>
<body>
   <!-- top bar -->
   <div id="topbar" class="container-fluid" align="center">

      <label class="btn btn-primary active">
         <input id="btnMale" type="checkbox" checked autocomplete="off">
         Male
      </label>

      <label class="btn btn-danger active">
         <input id="btnFemale" type="checkbox" checked autocomplete="off">
         Female
      </label>

      <label for="inputNumber">How many?</label>
      <select id="inputNumber" class="form-control">
         <option selected=true value=10>Top 10</option>
         <option value=100>Top 100</option>
         <option value=1000>Top 1000</option>
      </select>
   </div>

</div>

<!-- chart container -->
<div id="chart" class="container-fluid" align="center">
</div>
</body>

<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

<!-- d3 -->
<script src="https://d3js.org/d3.v2.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
   // load and process data from csv
   d3.csv("data/babynames.csv", function(data) {
      // form event handlers
      $("#btnMale")
      .on("change", function(d){
         draw()
      })

      $("#btnFemale")
      .on("change", function(d){
         draw()
      })

      $("#inputNumber")
      .on("change", function(d){
         draw()
      })

      //convert numerical values from strings to numbers
      data = data.map(function(d){
         d.value = +d["count"]
         return d
      })

      // add color data
      data = data.map(function(d){
         if(d.gender == "M"){
            d.color = "blue"
            return d
         }
         else if(d.gender == "F"){
            d.color = "pink"
            return d
         }
      })

      data = shuffle(data)

      // Fisher Yates Sort Algorithm https://bost.ocks.org/mike/shuffle/
      function shuffle(array) {
         var m = array.length, t, i
         // While there remain elements to shuffle…
         while (m) {
            // Pick a remaining element…
            i = Math.floor(Math.random() * m--)
            // And swap it with the current element.
            t = array[m]
            array[m] = array[i]
            array[i] = t
         }
         return array
      }

      console.log("Filtered Data")
      console.log(filter(data))
      function filter(data){
         var selectionMale = $("#btnMale").is(':checked')
         var selectionFemale = $("#btnMale").is(':checked')
         var selectionDropdown = $("#inputNumber").val()
         var maleArray = data.filter(function(d){
            return d.gender == "M"
         })
         var femaleArray = data.filter(function(d){
            return d.gender == "M"
         })
         var mergedArray = maleArray.concat(femaleArray)
         return mergedArray
      }

      function draw(){
         filteredData = filter(data)
         // max size of the chart
         var diameter = 2000

         // Set packing Algorithm
         // https://github.com/d3/d3-3.x-api-reference/blob/master/Pack-Layout.md#sort
         var bubble = d3.layout.pack()
         .size([diameter, diameter])
         .padding(1.5)
         .sort(null)

         var svg = d3.select("body")
         .append("svg")
         .attr("width", diameter)
         .attr("height", diameter)
         .attr("class", "bubble")

         // create bubble nodes
         var nodes = bubble.nodes({children:filter(data)}).filter(function(d) { return d });
         //setup the chart
         var bubbles = svg.append("g")
         .attr("transform", "translate(0,0)")
         .selectAll(".bubble")
         .data(nodes)
         .enter();

         //create the bubbles
         bubbles.append("circle")
         .attr("r", function(d){ return d.r })
         .attr("cx", function(d){ return d.x })
         .attr("cy", function(d){ return d.y })
         .style("fill", function(d){ return d.color })
         .append("title").text(function(d){ return d.name })

         //format the text for each bubble
         bubbles.append("text")
         .attr("x", function(d){ return d.x; })
         .attr("y", function(d){ return d.y + 5; })
         .attr("text-anchor", "middle")
         .text(function(d){ return d["name"]; })
         .style({
            "fill":"white",
            "font-family":"Helvetica Neue, Helvetica, Arial, san-serif",
            "font-size": "8px"
         })
      }
   })
})
</script>
</html>
